# SaveSyncApp

一个实用小工具，可以将游戏存档自动备份到指定目录（配置页面的同步目录，如不指定则为程序所在目录），搭配同步盘软件（百度、阿里、群辉）、虚拟盘软件（RaiDrive）即可实现在不同电脑间共享存档功能。



当前版本为 v0.3.0, 还处于持续更改中，特性增加和删除都很快，所以没有ChangeLog



## 使用指北

一.   如何使用

1.   在设置页面完成基本设置

2.   点击启动与日志页面的启动

3.   开启游戏（该游戏需由Steam启动或为全屏）

4.   关闭游戏

5.   等待同步完成

   

二.   如何同步

**<u>重要：当前版本，该软件永远不会自动加载存档，请在新电脑上运行游戏前手动点击同步！</u>**

1.   在设置页面完成基本设置（此前软件运行目录，该目录带有`profile.json`文件和`saves`文件夹，可以保存到移动硬盘、通过同步盘同步）
2.   在存档页面同步需要同步的游戏
   1.   如果发生存档不兼容（如：新电脑目录有更新的文件、新电脑目录有老电脑不存在的文件），该软件在进行文件操作前会发出提示，请放心操作
   2.   **唯一不安全的覆盖情况：新电脑同名文件比老电脑更老，该情况会自动覆盖**
      1.   为什么允许这种不安全的覆盖：如果交替在两台电脑上运行该软件，必然在同步前新电脑的文件是较老的，这种时候应该允许静默的覆盖所有文件
      2.   如果有必要，可能会在选项里新增一些限制条件，发生时询问用户
3.   现在，启动SaveSync和你的游戏，开始无缝畅玩吧！



## 原理说明

软件的主要逻辑都在**`SaveSync.cs`**中，该类采取依赖注入工作，基本做到独立于应用程序，但使用了大量windows API或依赖windows API运行的类和函数，因而与windows系统有较强绑定。

该软件会监控若干目录（这些目录可以在配置文件（不是配置页面，暂时没有相关设置）中找到并更改）

如果有程序向这些目录中写入文件时，检查前台窗口是否由steam启动（参见`ProcessHelper.cs`）或为全屏（参见`FullScreenDetect.cs`），检查后，使用该前台进程的文件路径、前台窗口的名称与写入路径进行关键词比较（参见`SteamDefaultMatch()`和`FullScreenDefaultMatch()`），如果该比较通过，则加入跟踪目录，启动一个任务等待游戏的退出，退出后将更新过的文件拷贝到同步目录下。

在保存配置时，将大多数依赖于当前Windows系统的地址替换为占位符(Placeholder, 参见`SpecialFolders.cs`)，在加载时才替换为本机地址，实现跨系统环境兼容性。



### 待改进点和一些吐槽

1.   MVVM写的跟一坨答辩一样
2.   总的来说，中间一些类的耦合程度控制的还行，增加功能的时候感觉还是比较轻松的
3.   你什么时候美化一下界面？  ***大概是下辈子***
4.   其实如果能像`ProcessMonitor`一样监控进程的文件写入日志就好了，我查到的方法大多依赖钩子注入，且不说远远谈不上无创，万一被反作弊飞了找谁哭去（***别找我，不关我事***）